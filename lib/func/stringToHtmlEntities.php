<?php

  function stringToHtmlEntities($str)
  {
    $lookup = function($n)
	{
      $map = array(
        128 => '&#0199;',
        129 => '&#0252;',
        130 => '&#0233;',
        131 => '&#0226;',
        132 => '&#0228;',
        133 => '&#0224;',
        134 => '&#0229;',
        135 => '&#0231;',
        136 => '&#0234;',
        137 => '&#0235;',
        138 => '&#0232;',
        139 => '&#0239;',
        140 => '&#0238;',
        141 => '&#0236;',
        142 => '&#0196;',
        143 => '&#0197;',
        144 => '&#0201;',
        145 => '&#0230;',
        146 => '&#0198;',
        147 => '&#0244;',
        148 => '&#0246;',
        149 => '&#0242;',
        150 => '&#0251;',
        151 => '&#0249;',
        152 => '&#0255;',
        153 => '&#0214;',
        154 => '&#0220;',
        155 => '&#0162;',
        156 => '&#0163;',
        157 => '&#0165;',
        158 => '&#8359;',
        159 => '&#0402;',
        160 => '&#0225;',
        161 => '&#0237;',
        162 => '&#0243;',
        163 => '&#0250;',
        164 => '&#0241;',
        165 => '&#0209;',
        166 => '&#0170;',
        167 => '&#0186;',
        168 => '&#0191;',
        169 => '&#8976;',
        170 => '&#0172;',
        171 => '&#0189;',
        172 => '&#0188;',
        173 => '&#0161;',
        174 => '&#0171;',
        175 => '&#0187;',
        176 => '&#9617;',
        177 => '&#9618;',
        178 => '&#9619;',
        179 => '&#9474;',
        180 => '&#9508;',
        181 => '&#9569;',
        182 => '&#9570;',
        183 => '&#9558;',
        184 => '&#9557;',
        185 => '&#9571;',
        186 => '&#9553;',
        187 => '&#9559;',
        188 => '&#9565;',
        189 => '&#9564;',
        190 => '&#9563;',
        191 => '&#9488;',
        192 => '&#9492;',
        193 => '&#9524;',
        194 => '&#9516;',
        195 => '&#9500;',
        196 => '&#9472;',
        197 => '&#9532;',
        198 => '&#9566;',
        199 => '&#9567;',
        200 => '&#9562;',
        201 => '&#9556;',
        202 => '&#9577;',
        203 => '&#9574;',
        204 => '&#9568;',
        205 => '&#9552;',
        206 => '&#9580;',
        207 => '&#9575;',
        208 => '&#9576;',
        209 => '&#9572;',
        210 => '&#9573;',
        211 => '&#9561;',
        212 => '&#9560;',
        213 => '&#9554;',
        214 => '&#9555;',
        215 => '&#9579;',
        216 => '&#9578;',
        217 => '&#9496;',
        218 => '&#9484;',
        219 => '&#9608;',
        220 => '&#9604;',
        221 => '&#9612;',
        222 => '&#9616;',
        223 => '&#9600;',
        224 => '&#0945;',
        225 => '&#0223;',
        226 => '&#0915;',
        227 => '&#0960;',
        228 => '&#0931;',
        229 => '&#0963;',
        230 => '&#0181;',
        231 => '&#0964;',
        232 => '&#0934;',
        233 => '&#0920;',
        234 => '&#0937;',
        235 => '&#0948;',
        236 => '&#8734;',
        237 => '&#0966;',
        238 => '&#0949;',
        239 => '&#8745;',
        240 => '&#8801;',
        241 => '&#0177;',
        242 => '&#8805;',
        243 => '&#8804;',
        244 => '&#8992;',
        245 => '&#8993;',
        246 => '&#0247;',
        247 => '&#8776;',
        248 => '&#0176;',
        249 => '&#8729;',
        250 => '&#0183;',
        251 => '&#8730;',
        252 => '&#8319;',
        253 => '&#0178;',
        254 => '&#9632;',
        255 => '&#0160;'
      );
	  if ($n == 13) {
		return "<br />";
	  }
	  if (isInRange($n, 0, 31)) { // || ($n == 127)) {
		return "";
	  }
	  if ($n == 32) {
		return "&nbsp;";
	  }
	  return ($n < 128) ? chr($n) : $map[$n];
    };
	
    $str = mb_convert_encoding($str, 'UTF-32', 'Windows-1252');
    $t = unpack("N*", $str);
    $t = array_map($lookup, $t);
	return array_values(array_filter($t));
  } // stringToHtmlEntities

?>